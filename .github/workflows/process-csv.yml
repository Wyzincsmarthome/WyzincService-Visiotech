name: Process CSV and Upload to Shopify

on:
  push:
    paths:
      - 'csv-input/**'
      - 'csv-processor/**'
      - '.github/workflows/process-csv.yml'

jobs:
  process-upload:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do cÃ³digo
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Instalar dependÃªncias
        run: npm install

      - name: Encontrar ficheiro CSV
        id: findcsv
        run: |
          CSV_FILE=$(ls csv-input/*.csv | head -n 1)
          echo "CSV_FILE=$CSV_FILE" >> $GITHUB_ENV
          echo "Ficheiro CSV encontrado: $CSV_FILE"

      - name: Processar CSV e fazer upload
        env:
          SHOPIFY_STORE: ${{ secrets.SHOPIFY_STORE }}
          SHOPIFY_ACCESS_TOKEN: ${{ secrets.SHOPIFY_ACCESS_TOKEN }}
          CSV_FILE: ${{ env.CSV_FILE }}
        run: |
          echo "ðŸš€ Iniciando processamento CSV..."
          node csv-processor/process_csv.js "$CSV_FILE"
